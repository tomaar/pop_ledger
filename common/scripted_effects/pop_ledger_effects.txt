log_default = {
	every_state = { 
		set_variable = {
			var = pop_default
			value = state_population_k
		}
		set_variable = {
			var = owner_default
			value = owner
		}
	}
}

load_states = {
	every_country = {
		every_owned_state = {
			add_to_array = {
				array = global.pop_array
				value = THIS
			}
		}
	}
}

update_pop = {
	every_state = { 
		set_variable = {
			var = pop_current
			value = state_population_k
		}
		set_variable = {
			var = owner_current
			value = owner
		}

		# Setting up the pop_diff variable
		set_variable = {
			var = pop_diff
			value = pop_current
		}
		subtract_from_variable = {
			var = pop_diff
			value = pop_default
		}
		divide_variable = {
			var = pop_diff
			value = pop_default
		}
	}
}

open_pop_ledger = {
	set_country_flag = pop_ledger_open
	update_pop = yes
}

pop_ledger_setup = {
	log_default = yes
	load_states = yes
}